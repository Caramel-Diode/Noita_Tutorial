const gdDoc=(()=>{const articleMap=new Map();let defaultArticle=undefined;const matchMediaResult=matchMedia("(max-aspect-ratio:1)");const returnObj={articles:articleMap,showArticle:undefined};class ArticleChangedEvent extends Event{title;article;constructor(title,article){super("articleChanged");this.title=title;this.article=article;}}const u={svgStrToObjectURL:str=>URL.createObjectURL(new Blob([str],{type:"image/svg+xml"})),generateCSSStyleSheet:rules=>{const css=new CSSStyleSheet();css.replaceSync(rules);return css;},getExplorerInfo:()=>{let Sys={};let ua=navigator.userAgent.toLowerCase();let s;(s=ua.match(/rv:([\d.]+)\)like gecko/))?Sys.ie=s[1]:(s=ua.match(/msie([\d\.]+)/))?Sys.ie=s[1]:(s=ua.match(/edge\/([\d\.]+)/))?Sys.edge=s[1]:(s=ua.match(/firefox\/([\d\.]+)/))?Sys.firefox=s[1]:(s=ua.match(/(?:opera|opr).([\d\.]+)/))?Sys.opera=s[1]:(s=ua.match(/chrome\/([\d\.]+)/))?Sys.chrome=s[1]:(s=ua.match(/version\/([\d\.]+).*safari/))?Sys.safari=s[1]:0;if(Sys.ie)return'IE: '+Sys.ie;else if(Sys.edge)return'EDGE: '+Sys.edge;else if(Sys.firefox)return'Firefox: '+Sys.firefox;else if(Sys.chrome)return'Chrome: '+Sys.chrome;else if(Sys.opera)return'Opera: '+Sys.opera;else if(Sys.safari)return'Safari: '+Sys.safari;}};;const icons={headingFoldOrExpand:`<svg baseProfile="full" width="16" height="16" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><path stroke="#C69BC5" fill="transparent" stroke-linecap="round" stroke-linejoin="round" stroke-width="10" d="M20 6l30 26v1L20 58" /></svg>`,asideFoldOrExpand:`<svg baseProfile="full" width="32" height="32" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><path stroke="#C69BC5" fill="transparent" stroke-linecap="round" stroke-linejoin="round" stroke-width="5" d="M10 14H54M10 32H54M10 50 H54"></path></svg>`};const cssStyleSheet=u.generateCSSStyleSheet(`body.main{--default-grid-template:'header header'50px'aside main'1fr'footer footer'16px/0px 1fr;grid-template:var(--current-grid-template, var(--default-grid-template));}body.aside{--default-grid-template:'header header'50px'aside main'1fr'footer footer'16px/75vw 1fr;grid-template:var(--current-grid-template, var(--default-grid-template));}@media(max-aspect-ratio:1){body.main{--current-grid-template:'header header'50px'aside main'1fr'footer footer'16px/0px 1fr;}body.aside{--current-grid-template:'header header'50px'aside main'1fr'footer footer'16px/75vw 1fr;}}@media(min-aspect-ratio:1){body.main{--current-grid-template:'header header'50px'aside main'1fr'footer footer'16px/0px 1fr;}body.aside{--current-grid-template:'header header'50px'aside main'1fr'footer footer'16px/20vw 1fr;}}*{font-family:Sans-serif;color:var(--theme-font-color1);box-sizing:border-box;}:root{--theme-color:#C69BC5;--theme-font-color1:#EEEEEE;--theme-font-color2:#CCCCCC;--theme-background-color1:#1E1E1E;--theme-background-color2:#3C3C3C;--theme-background-color3:#333333;--theme-background-color4:#474747;--theme-background-color5:#505050;}details{margin:10px 0 0 0;transition:all 100ms linear;}details.hidden{display:none;}details.visible{min-width:150px;border-radius:6px;border:1px solid var(--theme-background-color5);padding:10px;overflow:auto;}summary{display:inline-grid;place-items:center stretch;place-content:start;color:var(--theme-font-color2);font-size:18px;font-weight:bold;list-style:none;cursor:pointer;white-space:nowrap;background:var(--theme-background-color4);border-radius:3px;--border-color:transparent;border:1px solid var(--border-color);transition:all 150ms linear;}summary:hover{color:var(--theme-color);--border-color:var(--theme-color);background:transparent;}summary.subtitle-doNotOwn{grid-template:'foldOrExpandButton skipLink'/0 auto;}summary.subtitle-own{grid-template:'foldOrExpandButton skipLink'/24px auto;}a.skipLink{display:flex;place-items:center;place-content:center;grid-area:skipLink;padding:4px 8px;}details>ol{list-style:none;padding:0 0 0 15px;margin:0;}body{margin:0;padding:0;display:grid;width:100vw;height:100vh;transition:all 150ms linear;overflow:hidden;background:var(--theme-background-color1);}header{display:flex;flex-direction:row;grid-area:header;background:var(--theme-background-color2);border-bottom:2px solid var(--theme-background-color4);place-items:center start;}a.logo{display:grid;height:40px;place-content:center;font-size:larger;font-weight:bolder;}header>nav{margin:0 16px;}header>nav>a{padding:0 5px;cursor:pointer;transition:all 150ms linear;}header>nav>a:hover{text-decoration-line:underline;}header>nav>a:last-child{font-size:large;font-weight:bold;color:var(--theme-color);}aside{background:var(--theme-background-color2);grid-area:aside;padding:20px;overflow:auto;transition:opacity 150ms linear;}body.main>aside{opacity:0;}body.aside>aside{opacity:1;}main{grid-area:main;background:var(--theme-background-color1);padding:0 25px;overflow:auto;scrollbar-color:var(--theme-color) var(--theme-background-color1);}footer{background:var(--theme-color);grid-area:footer;}.button-heading-fold,.button-heading-expand{grid-area:foldOrExpandButton;height:100%;background-color:transparent;background-image:url("${u.svgStrToObjectURL(icons.headingFoldOrExpand)}");background-repeat:no-repeat;background-size:16px 16px;background-position:center;border:none;padding:0;overflow:hidden;cursor:pointer;transition:all 100ms linear;}.button-heading-fold{transform:rotateZ(90deg);}.button-heading-expand{transform:rotateZ(0deg);}.button-aside-fold,.button-aside-expand{display:grid;height:36px;width:36px;background-color:transparent;background-image:url("${u.svgStrToObjectURL(icons.asideFoldOrExpand)}");border-radius:6px;padding:0;margin:0 10px;transition:border 100ms linear;}.button-aside-fold{border:2px solid var(--theme-color);}.button-aside-expand{border:2px solid transparent;} button{background:var(--theme-color);border:none;}`);const gdDocElement=class HTMLGdDocElement extends HTMLBodyElement{static{customElements.define("gd-doc",this,{extends:"body"});}#header;#aside;#main;#footer;#a_logo;#button_asideFoldOrExpand;#nav_breadcrumb;#currentArticle;initialTitle=document.title;updateBreadcrumbNav=heading=>{if(this.#nav_breadcrumb.breadcrumb!==heading.breadcrumb){this.#nav_breadcrumb.breadcrumb=heading.breadcrumb;this.#nav_breadcrumb.innerHTML="";for(let a of this.#nav_breadcrumb.breadcrumb){this.#nav_breadcrumb.append(a,"/");}this.#nav_breadcrumb.lastChild.remove();}};scrollUpdateBreadcrumbNav=e=>{if(this.#currentArticle){let minDiff=Infinity;let currentHeading=this.#currentArticle.headings[0];if(currentHeading){for(const heading of this.#currentArticle.headings){let diff=this.#main.scrollTop-heading.offsetTop;let absDiff=Math.abs(diff);if(absDiff<minDiff){if(diff>=0){minDiff=absDiff;currentHeading=heading;}}}this.updateBreadcrumbNav(currentHeading);}}};#showArticle(article,title=""){let existing=false;for(let i=0;i<this.#main.children.length;i++){if(this.#main.children[i]===article){existing=true;if(article.hasAttribute("style")){article.removeAttribute("style");this.dispatchEvent(new ArticleChangedEvent(title,article));this.#nav_breadcrumb.innerHTML="";document.title=`${this.initialTitle} | ${title}`;}}else{this.#main.children[i].style.display="none";}}if(!existing){this.#main.append(article);this.dispatchEvent(new ArticleChangedEvent(title,article));this.#nav_breadcrumb.innerHTML="";document.title=`${this.initialTitle} | ${title}`;}};generateTableOfContents=(()=>{const switchArticle={_:(e)=>{let target=e.target;while(!(target instanceof HTMLAnchorElement&&target.classList.contains("skipLink"))){target=target.parentElement;}const article=target.relatedArticleElement;this.#currentArticle=article;if(matchMediaResult.matches){if(this.className==="aside")this.#button_asideFoldOrExpand.click();}this.#showArticle(article,target.innerHTML);},mouseFn:e=>{switchArticle._(e);},keyboardFn:e=>{if(e.key==="Enter")switchArticle._(e);}};const skip={activateAtuoUpdateBreadcrumbNav:()=>{this.#main.addEventListener("scroll",this.scrollUpdateBreadcrumbNav);},_:e=>{switchArticle._(e);let target=e.target;while(!(target instanceof HTMLAnchorElement&&target.classList.contains("skipLink"))){target=target.parentElement;}target.relatedHeadingElement.scrollIntoView({behavior:"smooth",block:"start",inline:"start"});this.#main.removeEventListener("scroll",this.scrollUpdateBreadcrumbNav);setTimeout(skip.activateAtuoUpdateBreadcrumbNav,1500);this.updateBreadcrumbNav(target.relatedHeadingElement);},mouseFn:e=>{skip._(e);},keyboardFn:e=>{if(e.key==="Enter")skip._(e);}};const foldOrExpand={_:e=>{if(e.target.relatedDetailsElement.open){e.target.relatedDetailsElement.open=false;e.target.className="button-heading-expand";}else{e.target.relatedDetailsElement.open=true;e.target.className="button-heading-fold";}},mouseFn:e=>{foldOrExpand._(e);},};const summaryPreventDefault=e=>{e.preventDefault();};const summaryContextmenuFn=e=>{e.preventDefault();const element=e.target;switch(element.tagName){case"BUTTON":element.click();break;case"A":element.parentElement.children[0].click();break;case"SUMMARY":element.children[0].click();}};return articles=>{const result=[];for(const data of articles){const title=data[0];const article=data[1];const root=document.createElement("details");const root_summary=document.createElement("summary");const root_ol=document.createElement("ol");const root_button=document.createElement("button");const root_a=document.createElement("a");root_button.tabIndex=-1;root_button.className="button-heading-expand";root_button.relatedDetailsElement=root;root_button.addEventListener("click",foldOrExpand.mouseFn);root_a.innerHTML=title;root_a.className="skipLink";root_a.tabIndex=0;root_a.relatedArticleElement=article;root_a.addEventListener("click",switchArticle.mouseFn);root_a.addEventListener("keydown",switchArticle.keyboardFn);root_summary.append(root_button,root_a);root_summary.className="subtitle-doNotOwn";root_summary.tabIndex=-1;root_summary.addEventListener("click",summaryPreventDefault);root_summary.addEventListener("contextmenu",summaryContextmenuFn);root.append(root_summary,root_ol);article.headings=[];result.push(root);let lastOl=root_ol;let lastLevel=1;for(const e of article.children){if(e instanceof HTMLHeadingElement){article.headings.push(e);let currentLevel=0;switch(e.tagName){case"H1":currentLevel=1;break;case"H2":currentLevel=2;break;case"H3":currentLevel=3;break;case"H4":currentLevel=4;break;case"H5":currentLevel=5;break;case"H6":currentLevel=6;break;}let currentOl=lastOl;if(currentLevel<=lastLevel){let details=lastOl.parentElement;for(let i=currentLevel;i<lastLevel;i++){details=details.parentElement.parentElement.parentElement;}currentOl=details.children[1];}else if(currentLevel-1!==lastLevel){console.error("不规范的标题层级!");return null;}const a=document.createElement("a");a.innerHTML=e.innerHTML;a.relatedHeadingElement=e;a.relatedArticleElement=article;a.tabIndex=0;a.addEventListener("click",skip.mouseFn);a.addEventListener("keydown",skip.keyboardFn);const breadcrumb=[];if(currentOl.parentElement.children[0].breadcrumb)breadcrumb.push(...currentOl.parentElement.children[0].breadcrumb);breadcrumb.push(a);e.breadcrumb=breadcrumb;const li=document.createElement("li");const details=document.createElement("details");const summary=document.createElement("summary");const button=document.createElement("button");const a_=document.createElement("a");const ol=document.createElement("ol");button.className="button-heading-expand";button.relatedDetailsElement=details;button.tabIndex=-1;button.addEventListener("click",foldOrExpand.mouseFn);a_.innerHTML=e.innerHTML;a_.className="skipLink";a_.relatedHeadingElement=e;a_.relatedArticleElement=article;a_.tabIndex=0;a_.addEventListener("click",skip.mouseFn);a_.addEventListener("keydown",skip.keyboardFn);summary.breadcrumb=breadcrumb;summary.append(button,a_);summary.relatedHeadingElement=e;summary.relatedArticleElement=article;summary.className="subtitle-doNotOwn";summary.tabIndex=-1;summary.addEventListener("click",summaryPreventDefault);summary.addEventListener("contextmenu",summaryContextmenuFn);details.append(summary,ol);li.appendChild(details);currentOl.append(li);currentOl.parentElement.children[0].className="subtitle-own";currentOl.parentElement.children[0].children[0].tabIndex=0;lastLevel=currentLevel+1;lastOl=ol;}}}return result;};})();loadContent=event=>{const template=this.querySelector(":scope>template[visible]");const template_hidden=this.querySelector(":scope>template[hidden]");if(template){const articleHTMLCollection=template.content.querySelectorAll("article");if(articleHTMLCollection.length){for(let article of articleHTMLCollection){articleMap.set(article.title,article);article.removeAttribute("title");if(article.hasAttribute("default")){defaultArticle=article;}}const fragment=document.createDocumentFragment();const tableOfContents=this.generateTableOfContents(articleMap);if(matchMediaResult.matches){this.className="main";this.#button_asideFoldOrExpand.className="button-aside-expand";for(let details of tableOfContents){details.className="hidden";}}else{this.className="aside";this.#button_asideFoldOrExpand.className="button-aside-fold";for(let details of tableOfContents){details.className="visible";}}this.#aside.append(...tableOfContents);fragment.append(this.#header,this.#aside,this.#main,this.#footer);this.append(fragment);this.dispatchEvent(new CustomEvent("articlesLoaded"));if(defaultArticle)this.#showArticle(defaultArticle);}else{console.warn("无法正确加载<article>");const h1=document.createElement("h1");h1.innerText="加载出错!";const template=document.createElement("template");template.id="bodyContent";template.append(...this.childNodes);this.append(h1,template);}}if(template_hidden){const articleHTMLCollection=template_hidden.content.querySelectorAll("article");if(articleHTMLCollection.length){for(let article of articleHTMLCollection){articleMap.set(article.title,article);article.removeAttribute("title");}}}};constructor(){super();const time_start=performance.now();document.adoptedStyleSheets=[cssStyleSheet];this.#header=document.createElement("header");this.#aside=document.createElement("aside");this.#main=document.createElement("main");this.#footer=document.createElement("footer");this.#a_logo=document.createElement("a");this.#button_asideFoldOrExpand=document.createElement("button");this.#nav_breadcrumb=document.createElement("nav");addEventListener("DOMContentLoaded",this.loadContent);this.#a_logo.className="logo";this.#a_logo.innerText=document.title;this.#button_asideFoldOrExpand.addEventListener("click",e=>{if(this.className==="main"){this.#button_asideFoldOrExpand.className="button-aside-fold";this.className="aside";for(let details of this.#aside.children){details.className="visible";}}else{this.#button_asideFoldOrExpand.className="button-aside-expand";this.className="main";for(let details of this.#aside.children){details.className="hidden";}}});this.#header.append(this.#button_asideFoldOrExpand,this.#a_logo,this.#nav_breadcrumb);this.#aside.addEventListener("contextmenu",e=>{e.preventDefault();const element=e.target;switch(element.tagName){case"DETAILS":case"ASIDE":this.#button_asideFoldOrExpand.click();}});this.#main.addEventListener("scroll",this.scrollUpdateBreadcrumbNav);const strong_explorerInfo=document.createElement("strong");strong_explorerInfo.innerText=u.getExplorerInfo();this.#footer.append(strong_explorerInfo);window.addEventListener("load",()=>{const strong=document.createElement("strong");strong.innerText=`  加载耗时: ${performance.now() - time_start}ms`;this.#footer.append(strong);});returnObj.showArticle=article=>this.#showArticle(article);};};;return returnObj;})();